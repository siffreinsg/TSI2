# Import
import csv
from math import sqrt
import matplotlib.pyplot as plt


# Fonctions
def som_rect(l_x, l_y, a, b):
    A = 0
    for index, x in enumerate(l_x):
        if a <= x <= b:
            A += l_y[index]
    return A * (l_x[1] - l_x[0])


def F_moy(l_x, l_y, periode):
    return 1 / periode * som_rect(l_x, l_y, 0, periode)


def F_eff(l_x, l_y, periode):
    l_y2 = [y ** 2 for y in l_y]
    return sqrt(F_moy(l_x, l_y2, periode))


def puissance(tension, courant):
    return [u * i for u, i in zip(tension, courant)]


def puissance_active(tensionEfficace, courantEfficace):
    pass


# Ouverture du CSV
fichier = csv.reader(open("C:\\Users\\Siffrein JACOBE\\Documents\\Coding\\tsi2\\SII TP série 2\\signaux.csv", "r"))

temps = []
tension = []
courant = []

# Lecture du CSV
for row in fichier:
    temps.append(float(row[0]))
    tension.append(100 * float(row[1]))
    courant.append(10 * float(row[2]))

# Calculs utiles
freq = 50
periode = 1 / freq

tensionMoyenne = F_moy(temps, tension, periode)
tensionEfficace = F_eff(temps, tension, periode)

courantMoyen = F_moy(temps, courant, periode)
couranteEfficace = F_eff(temps, courant, periode)

print("=== TENSION ===")
print("Moyenne:", tensionMoyenne, "V")
print("Efficace:", tensionEfficace, "V")

print("=== COURANT ===")
print("Moyenne:", courantMoyen, "A")
print("Efficace:", couranteEfficace, "A")

# Affichage des courbes
fig, axs = plt.subplots(3, sharex=True)

fig.suptitle("Fermeture de la porte")

axs[0].set_title("W=f(t)")
axs[0].set_ylabel("Tension W (V)")
axs[0].plot(temps, tension, color="blue")

axs[1].set_title("I_W=f(t)")
axs[1].set_ylabel("Courant I_W (V)")
axs[1].plot(temps, courant, color="red")

axs[2].set_title("P=W*I_W")
axs[2].set_xlabel("Temps (s)")
axs[2].set_ylabel("Puissance P (W)")
axs[2].plot(temps, puissance(tension, courant), color="grey")

plt.show()


# Tension à zéro pour t = 0,00923
# Courant à zéro pour t = 0,01338
